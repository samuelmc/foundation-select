"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();!function(e){var t=function(){function t(i,s){return _classCallCheck(this,t),this.$select=i,this.$select.is("select")?(this.options=e.extend({},t.defaults,this.$select.data(),s),this.$select.prop("multiple")?this._initMultiple():this._init(),Foundation.registerPlugin(this,"Select"),void Foundation.Keyboard.register("Select",{SPACE:"open",ESCAPE:"close",TAB:"tab",SHIFT_TAB:"tab",ARROW_UP:"select_up",ARROW_DOWN:"select_down"})):void console.warn("The select can only be used on a <select> element.")}return _createClass(t,[{key:"_initMultiple",value:function(){var t=this,i=Foundation.GetYoDigits(6,"select"),s=e('label[for="'+this.$select.attr("id")+'"]'),l=e('<div class="select-wrapper">'),a=e('<div class="select-container">'),n=e('<div data-perfect-scrollbar data-theme="foundation-select">');this.$select.wrap(l),this.$select.after(a),this.$element=e('<div id="'+i+'" class="multiple-select" tabindex="0">'),this.options.multiDisplayList&&(this.$listDisplay=this._buildListDisplay(i),this.$element.append(this.$listDisplay)),this.$element.append(n),a.append(this.$element),s.attr("for",i),this.$list=e("<ul>"),n.append(this.$list),this.$options={},this.$autoSelect=[],this.$select.find("> *").each(function(i,s){e(s).is("optgroup")&&t._addGroup(e(s),t.$list),e(s).is("option")&&t._addOption(e(s),t.$list)}),this.$element.attr("placeholder",this.options.placeholder),a.foundation(),this._eventsMultiple(),this.$autoSelect.length&&e.each(this.$autoSelect,function(e,i){t.$options[i].find("a").trigger("click")})}},{key:"_buildListDisplay",value:function(t){var i=e('<div id="'+t+'-display" class="list-display">'),s=e('<div data-perfect-scrollbar data-suppress-scroll-y="true" data-use-both-wheel-axes="true" data-theme="foundation-multiselect-display">'),l=e("<ul>");return l.append(e("<li>&nbsp;</li>")),s.append(l),i.append(s),i}},{key:"_init",value:function(){var t=this,i=Foundation.GetYoDigits(6,"select"),s=Foundation.GetYoDigits(6,"select-dropdown"),l=e('label[for="'+this.$select.attr("id")+'"]'),a=e('<div class="select-wrapper">'),n=e('<div class="select-container">');this.$select.wrap(a),this.$select.after(n),this.$element=e('<input type="text" id="'+i+'" data-toggle="'+s+'" readonly>'),n.append(this.$element),l.attr("for",i),this.$selectTriangle=e('<i class="select-triangle fa '+this.options.iconClass+'" data-toggle="'+s+'">'),n.append(this.$selectTriangle),this.$scroll=e("<div data-perfect-scrollbar>"),this.$dropdown=e("<div>"),this.$dropdown.attr({id:s,class:"select-dropdown","data-dropdown":"","data-v-offset":this.options.dropdownOffset,"data-h-offset":0,"data-close-on-click":!0,"data-position":"bottom","data-alignment":"right"}),this.$dropdown.append(this.$scroll),n.append(this.$dropdown),this.$list=e("<ul>"),this.$scroll.append(this.$list),this.$options={},this.$autoSelect=[],this._setPlaceholderOption(),this.$select.find("> *").each(function(i,s){e(s).is("optgroup")&&t._addGroup(e(s),t.$list),e(s).is("option")&&t._addOption(e(s),t.$list)}),this.$element.attr("placeholder",this.options.placeholder),n.foundation(),this._events(),this.$autoSelect.length&&e.each(this.$autoSelect,function(e,i){t.$options[i].find("a").trigger("click")})}},{key:"_setPlaceholderOption",value:function(){var t=void 0;this.$select.find("option").each(function(i,s){""==e(s).val()&&(t=!0)}),t||""==this.options.placeholder||this.$select.prepend(e('<option value="">'+this.options.placeholder+"</option>"))}},{key:"_addGroup",value:function(t,i){var s=this,l=t.attr("label"),a=e('<li class="group-item">'),n=e('<a class="group-label">'+l+"</a>"),o=e('<ul class="group-list">');a.append(n),a.append(o),i.append(a),t.find("> *").each(function(t,i){s._addOption(e(i),o)})}},{key:"_addOption",value:function(t,i){var s=t.val(),l=t.text();return""==s?void(this.options.placeholder=""==this.options.placeholder?l:this.options.placeholder):(t.is(":selected")&&(this.$autoSelect[this.$autoSelect.length]=s),void(this.$options[s]=e('<li><a data-value="'+s+'">'+l+"</a></li>").appendTo(i)))}},{key:"_selectArrowDown",value:function(t){t.preventDefault();var i=e(this.$list.find("a.selected")[0]),s=void 0;if(i.parent().is(":last-child")){if(s=i,i.parent().parent().is(".group-list")&&!i.parents(".group-item").is(":last-child")){var l=i.parents(".group-item").next();l.is("li:not(.group-item)")&&(s=l.find("a")),l.is(".group-item")&&(s=l.find("a + ul li:first-child a"))}}else if(i.length>0){var a=i.parent().next();a.is("li:not(.group-item)")&&(s=a.find("a")),a.is(".group-item")&&(s=a.find("a + ul li:first-child a"))}else s=e(this.$list.find("li:first-child a")[0]);this.$select.val(s.data("value")),this.$element.val(s.text()),this.$list.find("li a").removeClass("selected"),s.addClass("selected"),this.$dropdown.hasClass("is-open")&&this.$scroll.foundation("scrollToElement",s)}},{key:"_selectArrowUp",value:function(t){t.preventDefault();var i=e(this.$list.find("a.selected")[this.$list.find("a.selected").length-1]),s=void 0;if(i.parent().is(":first-child")&&(s=i,i.parent().parent().is(".group-list")&&!i.parents(".group-item").is(":first-child"))){var l=i.parents(".group-item").prev();l.is("li:not(.group-item)")&&(s=l.find("a")),l.is(".group-item")&&(s=l.find("a + ul li:last-child a"))}if(i.length>0){var a=i.parent().prev();a.is("li:not(.group-item)")&&(s=a.find("a")),a.is(".group-item")&&(s=a.find("a + ul li:last-child a"))}else s=e(this.$list.find("li:last-child a")[this.$list.find("li:last-child a").length-1]);this.$select.val(s.data("value")),this.$element.val(s.text()),this.$list.find("li a").removeClass("selected"),s.addClass("selected"),this.$dropdown.hasClass("is-open")&&this.$scroll.foundation("scrollToElement",s)}},{key:"_eventsMultiple",value:function(){var t=this;this.$element.add(this.$dropdown).off("keybord.zf.dropdown").on("keydown.zf.select",function(e){Foundation.Keyboard.handleKey(e,"Select",{select_down:function(){return t._selectArrowDown(e)},select_up:function(){return t._selectArrowUp(e)}})}),e.each(this.$options,function(i,s){var l=e(s).find("a");l.on("click",t.select.bind(t))})}},{key:"_events",value:function(){var t=this;this.$element.off("mousewheel.zf.select").on("mousewheel.zf.select",function(e){t.$element.is(":focus")&&t.options.mousewheel&&(e.originalEvent.deltaY>0?t._selectArrowDown(e):t._selectArrowUp(e))}).add(this.$dropdown).off("keybord.zf.dropdown").on("keydown.zf.select",function(e){Foundation.Keyboard.handleKey(e,"Select",{open:function(){$target.is(t.$element)&&(t.$dropdown.trigger("open"),t.$dropdown.attr("tabindex",-1).focus(),e.preventDefault())},select_down:function(){return t._selectArrowDown(e)},select_up:function(){return t._selectArrowUp(e)},tab:function(){t.$dropdown.trigger("close")},close:function(){t.$dropdown.trigger("close"),t.$element.focus()}})}),this.$dropdown.on("show.zf.dropdown",function(){t.$element.focus()}),e.each(this.$options,function(i,s){var l=e(s).find("a");l.on("click",t.select.bind(t))})}},{key:"select",value:function(t){t.preventDefault();var i=e(t.currentTarget),s=this,l=!1;if(this.$select.is("select[multiple]")&&((t.ctrlKey||t.isTrigger)&&"default"===this.options.multiSelectMethod||"mouse-only"===this.options.multiSelectMethod))if((t.ctrlKey||"mouse-only"===this.options.multiSelectMethod)&&e.each(this.$select.val(),function(e,t){if(i.data("value")==t){var a=s.$select.val();a.splice(e,1),s.$select.val(a),l=!0}}),l){var a=this.$listDisplay.find("ul");a.find('li[data-value="'+i.data("value")+'"]').remove()}else this.$select.val((e.isArray(this.$select.val())?this.$select.val():[]).concat(i.data("value"))),this._setListDisplayItem(i,!1);else this.$select.is("select[multiple]")?(this.$select.val(i.data("value")),this.$list.find("li a").removeClass("selected"),this.options.multiDisplayList&&this._setListDisplayItem(i,!0)):(this.$select.val(i.data("value")),this.$element.val(i.text()),this.$list.find("li a").removeClass("selected"),this.$dropdown.trigger("close"));l?i.removeClass("selected"):i.addClass("selected"),this.$element.trigger("selected.zf.select"),this.$select.trigger("change"),this.$element.focus()}},{key:"_unSelect",value:function(t){var i=this,s=e(t.currentTarget).parent(),l=this.$list.find('a[data-value="'+s.data("value")+'"]'),a=this.$listDisplay.find("ul");e.each(this.$select.val(),function(e,t){if(l.data("value")==t){var s=i.$select.val();s.splice(e,1),i.$select.val(s)}}),a.find('li[data-value="'+l.data("value")+'"]').remove(),l.removeClass("selected"),this.$element.trigger("selected.zf.select"),this.$select.trigger("change"),this.$element.focus()}},{key:"_setListDisplayItem",value:function(t,i){var s=this.$listDisplay.find("ul"),l=this.$list.find('a[data-value="'+t.data("value")+'"]').text(),a=e("<a data-unselect>&times;</a>"),n=e('<li data-value="'+t.data("value")+'">'+l+"</li>");i&&(s.empty(),s.append(e("<li>&nbsp;</li>"))),n.append(a),s.append(n),a.on("click",this._unSelect.bind(this))}},{key:"destroy",value:function(){this.$wrapper.after(this.$select.detach()),this.$wrapper.remove(),Foundation.unregisterPlugin(this)}}],[{key:"defaults",get:function(){return{iconClass:"fa-caret-down",placeholder:"",value:"",mousewheel:!0,dropdownOffset:0,multiSelectMethod:"default",multiDisplayList:!0}}}]),t}();Foundation.plugin(t,"Select")}(jQuery);